#cloud-config
hostname: apache_test1
fqdn: apache_test1.nutanix.local

write_files:
  - path: /etc/sysconfig/network-scripts/ifcfg-eth0
    content: |
     DEVICE=eth0
     BOOTPROTO="none"
     PREFIX=24
     IPADDR="192.168.178.15"
     GATEWAY="192.168.178.1"
     ONBOOT="yes"
     
  - path: /etc/resolve.conf
    content: |
     search nutanix.local
     nameserver 192.168.178.12
     nameserver fd00::9ec7:a6ff:fe1d:c3f2

  - path: /etc/sysconfig/network
    content: |
     NETWORKING=yes
     GATEWAY=192.168.178.1

yum_repos:
   # The name of the repository
   salstack:
      # Any repository configuration options
      # See: man yum.conf
      #
      # This one is required!
      baseurl: https://repo.saltstack.com/yum/redhat/$releasever/$basearch/latest
      enabled: true
      failovermethod: priority
      gpgcheck: true
      gpgkey: https://repo.saltstack.com/yum/redhat/$releasever/$basearch/latest/SALTSTACK-GPG-KEY.pub
              https://repo.saltstack.com/yum/redhat/$releasever/$basearch/latest/base/RPM-GPG-KEY-CentOS-7
      name: SaltStack repo for Red Hat Enterprise Linux $releasever

runcmd:
  - [ yum, -y, remove, NetworkManager* ]
  - [ systemctl, restart, network.service ]
  - [ yum, "-y", install, salt-minion ]
  - [ sed, -i, 's/#master: salt/master: saltmaster/g', /etc/salt/minion ]
  - [ systemctl, enable, salt-minion.service ]
  - [ systemctl, start, salt-minion.service ]

package_upgrade: true

power_state:
 mode: reboot
 message: Bye Bye
 timeout: 30
 condition: True
